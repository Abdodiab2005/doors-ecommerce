<section
  class="py-8 bg-base-100 text-neutral-800"
  x-data="{ activeTab: 'All' }"
>
  <div class="container max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div
      class="flex flex-col gap-2 p-3 justify-center items-start w-full h-max my-2"
    >
      <div class="text-center mb-8 px-4">
        <h1 class="text-2xl sm:text-3xl font-bold text-primary">
          Our Doors Collection
        </h1>
      </div>

      <div class="flex justify-center mb-10 overflow-x-auto">
        <div
          class="tabs tabs-boxed bg-base-200 inline-flex whitespace-nowrap"
          x-data="{ activeTab: '<%= currentCategory ? currentCategory : 'All' %>' }"
        >
          <% for (let cat of categories) { %>

          <a
            href="<%= cat.url %>"
            :class="{'tab-active font-semibold !bg-accent text-primary! ': activeTab === '<%= cat.name %>'}"
            class="tab tab-lg px-6 hover:text-primary hover:bg-accent m-1 transition-all duration-200 text-black"
          >
            <%= cat.name %>
          </a>
          <% } %>
        </div>
      </div>
    </div>

    <% if (searchQuery) { %>
    <p class="text-center text-neutral-400 mb-4">
      Showing
      <span class="font-semibold"> <%= products.length %> </span> results for
      "<%= searchQuery %>"
    </p>
    <% } %>

    <!-- prettier-ignore -->
    <div
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 sm:gap-6"
    >
      <% if (products && products.length > 0) { %> <% products.forEach(product => { %>
      <div
      data-url="/products/<%= product._id %>"
        class="card card-compact cursor-pointer bg-base-100 shadow-md border border-base-200 rounded-xl overflow-hidden transition-transform hover:scale-[1.02]"
        x-show="activeTab === 'All' || activeTab === '<%= product.category %>'"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 transform scale-90"
        x-transition:enter-end="opacity-100 transform scale-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100 transform scale-100"
        x-transition:leave-end="opacity-0 transform scale-90"
      >
        <figure class="aspect-4/3 bg-base-200">
          <img
            src="<%= product.images[0] %>"
            alt="<%= product.name %>"
            class="w-full h-full object-cover"
          />
        </figure>

        <div class="card-body p-4 sm:p-5 text-neutral-800">
          <div class="card-title flex justify-between items-start">
            <h3 class="text-base sm:text-lg font-semibold line-clamp-2">
              <%= product.name %>
            </h3>
            <span class="text-primary font-bold text-sm sm:text-base">
              $<%= product.price.toFixed(2) %>
            </span>
          </div>
          <a
            href="/products/<%= product._id %><%= searchQuery? '&q=' + searchQuery : '' %>"
            class="text-sm text-secondary hover:text-primary transition-colors mt-1"
          >
            View Details
          </a>
        </div>
      </div>
      <% }) %> <% } else { %>
      <p class="col-span-full text-center text-neutral-400">
        No products found.
      </p>
      <% } %>
    </div>

    <% if (totalPages > 1) { %>
    <div class="flex justify-center mt-10 text-primary">
      <div class="join">
        <a
          href="?page=<%= currentPage - 1 %><%= currentCategory? '&category=' + currentCategory : '' %><%= searchQuery? '&q=' + searchQuery : '' %>"
          class="join-item btn btn-sm sm:btn-md <%= (currentPage === 1) ? 'btn-disabled' : '' %>"
        >
          «
        </a>
        <button class="join-item btn btn-ghost btn-sm sm:btn-md no-animation">
          Page <%= currentPage %> of <%= totalPages %>
        </button>
        <a
          href="?page=<%= currentPage + 1 %><%= currentCategory? '&category=' + currentCategory : '' %><%= searchQuery? '&q=' + searchQuery : '' %>"
          class="join-item btn btn-sm sm:btn-md <%= (currentPage === totalPages) ? 'btn-disabled' : '' %>"
        >
          »
        </a>
      </div>
    </div>
    <% } %>
  </div>
</section>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cards = document.querySelectorAll(".card");
    cards.forEach((card) => {
      card.addEventListener("click", function () {
        const url = this.getAttribute("data-url");
        window.location.href = url;
      });
    });
  });
</script>
