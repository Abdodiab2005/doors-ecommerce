<div
  x-data="productPage()"
  class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-start mt-8 px-4 md:px-0"
>
  <!-- الصور -->
  <div class="flex flex-col">
    <div
      class="rounded-xl mx-auto shadow-lg overflow-hidden mb-4 border border-neutral-200 w-full max-w-[200px] aspect-[9/16]"
    >
      <img
        :src="mainImage"
        alt="Door preview"
        class="w-full h-full object-cover transition-all duration-500 ease-in-out"
        loading="lazy"
        width="900"
        height="1600"
      />
    </div>

    <div class="grid grid-cols-4 sm:grid-cols-5 gap-2 xs:gap-3">
      <template x-for="(image, i) in galleryImages" :key="i">
        <div
          @click="mainImage = image"
          :class="mainImage === image
            ? 'ring-2 ring-primary ring-offset-2'
            : 'ring-1 ring-transparent hover:ring-neutral-400'"
          class="rounded-lg overflow-hidden cursor-pointer transition-all duration-200 aspect-[9/16]"
        >
          <img
            :src="image"
            class="w-full h-full object-cover"
            alt="Door thumbnail"
            loading="lazy"
            width="90"
            height="160"
          />
        </div>
      </template>
    </div>
  </div>

  <!-- التفاصيل -->
  <div class="flex flex-col justify-center py-4">
    <h1
      class="text-3xl md:text-4xl font-bold mb-3 text-neutral-800 flex items-start justify-between"
    >
      <div>
        <div><%= product.name[lang] %></div>
        <span class="text-xs text-primary bg-secondary px-2 py-1 rounded-full">
          <i class="fa-solid fa-tag"></i> <%= category %>
        </span>
      </div>
      <button id="shareButton" class="btn btn-ghost btn-circle">
        <i class="fa-solid fa-share-nodes text-primary text-xl"></i>
      </button>
      <script>
        document
          .getElementById('shareButton')
          .addEventListener('click', function () {
            try {
              navigator.share({
                title: document.title,
                text: document.querySelector('meta[name="description"]')
                  .content,
                url: window.location.href,
              });
            } catch (err) {
              navigator.clipboard.writeText(window.location.href);
            }
          });
      </script>
    </h1>

    <p class="text-base text-neutral-400 mb-6 leading-relaxed">
      <%= product.description[lang] %>
    </p>

    <div class="mb-8">
      <label class="text-sm font-semibold text-neutral-800 mb-2 block">
        <%= __('product.available_colors') %>
      </label>
      <div class="flex flex-wrap items-center gap-3">
        <% for (let color of product.colors) { %>
        <button
          @click='changeColor("<%= color.hex %>", <%- JSON.stringify(color.images || []) %>)'
          class="btn btn-circle btn-md border-2 border-neutral-300 transition-transform hover:scale-105"
          style="background-color: <%= color.hex %>"
          aria-label="<%= color.name %>"
        ></button>
        <% } %>

        <!-- زر إلغاء التحديد -->
        <button
          @click="resetColor()"
          class="btn btn-outline btn-sm border-neutral-400 text-neutral-700 hover:bg-neutral-200"
        >
          <i class="fa-solid fa-rotate-left"></i> <%= __('product.reset_color')
          %>
        </button>
      </div>
    </div>

    <!-- CTA -->
    <div class="flex flex-col lg:flex-row gap-3 lg:gap-4">
      <a
        href="tel:<%= settings?.phone %>"
        class="btn btn-neutral btn-lg w-full lg:w-auto text-lg text-white"
      >
        <i class="fa-solid fa-phone"></i> <%= __('product.call_us') %>
      </a>
      <a
        href="https://wa.me/<%= (settings?.whatsapp)?.replace(/\D/g, '') %>"
        target="_blank"
        rel="noopener noreferrer"
        class="btn btn-outline btn-lg w-full lg:w-auto text-lg text-black"
      >
        <i class="fa-brands fa-whatsapp"></i> <%= __('product.whatsapp') %>
      </a>
      <a
        href="mailto:<%= settings?.email %>"
        class="btn btn-outline btn-lg w-full lg:w-auto text-lg text-black"
      >
        <i class="fa-solid fa-envelope"></i> <%= __('product.email') %>
      </a>
    </div>
  </div>
</div>

<script>
  function productPage() {
    const defaultImages = <%- JSON.stringify(product.images || []) %>;

    return {
      mainImage: defaultImages[0],
      galleryImages: defaultImages,

      changeColor(hex, images) {
        this.galleryImages = images.length ? images : defaultImages;
        this.mainImage = this.galleryImages[0];
      },

      resetColor() {
        this.galleryImages = defaultImages;
        this.mainImage = defaultImages[0];
      },
    };
  }
</script>
