<section
  x-data="loginForm()"
  class="w-full max-w-sm bg-white shadow-lg rounded-2xl p-8"
>
  <h1 class="text-2xl font-semibold text-center mb-6 text-gray-800">
    تسجيل الدخول
  </h1>

  <form @submit.prevent="submitForm" class="space-y-5">
    <!-- اسم المستخدم -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">
        اسم المستخدم
      </label>
      <input
        type="text"
        x-model="username"
        required
        class="w-full border border-gray-300 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white"
      />
    </div>

    <!-- كلمة المرور -->
    <div class="relative">
      <label class="block text-sm font-medium text-gray-700 mb-1">
        كلمة المرور
      </label>
      <input
        :type="showPassword ? 'text' : 'password'"
        x-model="password"
        required
        class="w-full border border-gray-300 rounded-lg py-2 px-3 pr-10 focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white"
      />

      <!-- زر العين باستخدام Font Awesome -->
      <button
        type="button"
        @click="showPassword = !showPassword"
        class="absolute right-3 top-9 text-gray-500 hover:text-gray-700 focus:outline-none"
      >
        <i x-show="!showPassword" class="fa-solid fa-eye w-5 h-5"></i>
        <i x-show="showPassword" class="fa-solid fa-eye-slash w-5 h-5"></i>
      </button>
    </div>

    <!-- زر الدخول -->
    <button
      type="submit"
      class="w-full bg-black text-white py-2 rounded-lg hover:bg-[#242425] transition"
      :disabled="loading"
    >
      <span x-show="!loading">دخول</span>
      <span x-show="loading" class="animate-pulse">جاري التحميل...</span>
    </button>

    <p
      x-show="error"
      x-text="error"
      class="text-red-500 text-sm text-center mt-2"
    ></p>
  </form>
</section>

<script>
  function loginForm() {
    return {
      username: "",
      password: "",
      showPassword: false,
      loading: false,
      error: "",
      async submitForm() {
        this.error = "";
        this.loading = true;
        try {
          const res = await fetch("/admin/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              username: this.username,
              password: this.password,
            }),
          });

          const data = await res.json();
          if (!res.ok) throw new Error(data.message || "حدث خطأ ما");
          window.location.href = "/admin/dashboard";
        } catch (err) {
          this.error = err.message;
        } finally {
          this.loading = false;
        }
      },
    };
  }
</script>
